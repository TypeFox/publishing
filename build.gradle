/*
 * Publishing script for open-source projects
 * Copyright 2016 TypeFox GmbH
 */

apply plugin: 'io.typefox.osspub'
apply from: 'artifacts.gradle'

def jenkinsRepo = { jobName ->
	"http://services.typefox.io/open-source/jenkins/job/${jobName}/lastStableBuild/artifact/build/maven-repository/"
}
def jenkinsPipelineRepo = { jobName ->
	"http://services.typefox.io/open-source/jenkins/job/${jobName}/job/${osspub.branch}/lastStableBuild/artifact/build/maven-repository/"
}
repositories {
	maven { url jenkinsRepo('lsapi') }
	maven { url jenkinsPipelineRepo('lsp4j') }
	maven { url jenkinsPipelineRepo('xtext-lib') }
	maven { url jenkinsPipelineRepo('xtext-core') }
	maven { url jenkinsPipelineRepo('xtext-extras') }
	maven { url jenkinsPipelineRepo('xtext-web') }
	maven { url jenkinsPipelineRepo('xtext-maven') }
	maven { url jenkinsPipelineRepo('xtext-xtend') }
	jcenter()
}

osspub {
	mavenUploadRepository 'ossrh'
	p2Repository {
		name 'Xtext'
		group 'modeling.tmf.xtext'
		url "http://services.typefox.io/open-source/jenkins/job/xtext/job/${osspub.branch}/lastSuccessfulBuild/artifact/build/org.eclipse.xtext.sdk.p2-repository-${osspub.version}.zip"
		namespace 'org.eclipse.xtext'
		namespace 'org.eclipse.xtend'
		namespace 'org.eclipse.lsp4j'
		referenceFeature 'org.eclipse.xtext.sdk'
		timestampPrefix 'v'
	}
}
